---
titulo: "Análise de Dados Categorizados"
subtitulo: "Trabalho Final"
aluno1:  "Carolina Musso 18/0047850"
aluno2: "Juliana Rosa"
orientador: "Maria Tereza Leão"
ano: "1/2023"
referencias: aux/referencias.bib
output: 
  bookdown::pdf_document2:
    template: aux/template.tex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      warning = FALSE, 
                      message = FALSE)
```

```{r bibliotecas}

rm(list = ls()) #will clear all objects includes hidden objects.
options(rstudio.help.showDataPreview = FALSE)
# Carregando bibliotecas ---------
pacman::p_load(tidyverse, rio, papeR, patchwork, kableExtra, pROC)


# Bases -----

dados <- import ("data/dados_trabalho.xlsx")

# amostra
set.seed(42)
amostra <- slice_sample(dados, n=100)

## Tratamento ----

names(amostra) <- c("ID", "idade", "status", "casa", "setor", "save" )

amostra_trat <- amostra %>% 
  mutate(status=factor(status, 
                       labels=c("Superior", "Médio", "Inferior")), 
         casa=factor(casa, labels=c("Não", "Sim")), 
         setor=factor(setor, levels=c(1,0), labels=c("B", "A")),
        save=factor(save, labels=c("Não", "Sim"))) %>% 
  as.data.frame()
```

\newpage

# Introdução e Objetivos

A habilidade e a possibilidade de poupar dinheiro pode estar relacionada a diversos fatores. \citeonline{economics} cita a idade, poder aquisitivo, desenvolvimento econômico e inflação como possíveis questões associadas. 

Este trabalho visa avaliar fatores associados a um chefe de ter familia ter ou não poupança por meio da seleção de um modelo de regressão logística. 

# Metodologia


## Variáveis 

A variável resposta analisada nesse estudo que tentará ser modelada é a variável qualitativa nominal binária "Porrui conta popuança". 

As variáveis explicativas (ou os fatores possíveismente associados) são:
- Idade, variável quantitativa medida em anos. 
- Status socioeconômico, variável qualitativa ordinal medida em: 1 - superior, 2 - médio , 3 - inferior.
- Possuir casa própria: variável qualitativa nominal (binária, onde "sim" corresponde a casa própria quitada.)
- Setor da cidade em que habita: Variável qualitativa nominal (Setor A ou B)


## Amostra

Para este trabalho, uma sub-amostra aleatória simples sem reposição foi selecionada a partir de uma amostra de 196 chefes de família. Os IDS selecionados nesse trabalho foram:

```{r}
sort(amostra$ID)
```

## Análise

A regressão logística é um modelo estatístico utilizado inicialmente para prever a probabilidade de ocorrência de um evento binário, como é o caso da variável resposta deste trabalho. Para tal, os conceitos da regressão linear são expandidos para comportar uma variável entre [0,1] (a probabilidade), utilizando a função logito.

Assim,  modela-se a média da variável resposta por 

$\pi = \frac{exp{(\beta_0 + |beta_1 X_i)}}{1-(\beta_0 + |beta_1 X_i)}$

# Resultados


## Análise descritiva gráficos


### Idade
```{r}
idade_by <- amostra_trat %>% 
  ggplot(aes(x=save, y=idade, fill=save))+
   geom_boxplot()+
   scale_fill_manual(values=c("#00822E", "#0068B4"))+
   #geom_jitter(color="black", size=0.4, alpha=0.9) +
   theme_classic(base_size = 14)+
   theme(legend.position = "none")+
   labs(x= "Tem Poupança", y= "Idade (Anos)")
   


idade <- amostra_trat %>% 
   ggplot(aes(y=idade))+
   geom_boxplot()+
  #geom_jitter( color="black", size=0.4, alpha=0.9) +
  theme_classic(base_size = 10)+
   theme(legend.position = "none", 
         axis.text.x = element_blank(), 
         axis.ticks = element_blank(),
         axis.line.x = element_blank(),
          axis.line.y = element_blank(),
         panel.border = element_rect(colour = "black", fill=NA))+
   labs(x= "", y= "")+
  ggtitle("Geral")
```

```{r, out.width="90%"}
 idade_by +  inset_element(idade, left = 0.01, bottom = 0.45, right = 0.25, top = 1)
```

### Status Socio econômico

```{r}
status_by <- amostra_trat %>% 
  ggplot(aes(x=save,fill=factor(status)))+
   geom_bar(position="fill", color="black")+
   scale_fill_manual(values=c("#00822E", "#7E7E65", "#0068B4"))+
   #geom_jitter(color="black", size=0.4, alpha=0.9) +
   theme_classic(base_size = 14)+
   theme(legend.position = "none")+
   labs(x= "Tem Poupança", y= "Proporção")
   


status <-   amostra_trat %>% 
  ggplot(aes(x=1,fill=factor(status)))+
  geom_bar(position="fill", color="black")+
  scale_fill_manual("",values=c("#00822E", "#7E7E65", "#0068B4"))+
  theme_classic(base_size = 14)+
  theme( axis.text.x = element_blank(),
        axis.ticks = element_blank())+
  labs(x= "", y= "")+
  ggtitle("Geral")
```

```{r, out.width="90%"}
 status_by +  status+  plot_layout(widths = c(2, 1))
```



### Possui casa própria quitada

```{r}
casa_by <- amostra_trat %>% 
  ggplot(aes(x=save,fill=factor(casa)))+
   geom_bar(position="fill", color="black")+
   scale_fill_manual("", values=c("#00822E", "#0068B4"))+
   #geom_jitter(color="black", size=0.4, alpha=0.9) +
   theme_classic(base_size = 14)+
   theme(legend.position = "none")+
   labs(x= "Tem Poupança", y= "Proporção")
   


casa<-   amostra_trat %>% 
  ggplot(aes(x=1,fill=factor(casa)))+
  geom_bar(position="fill", color="black")+
  scale_fill_manual("", values=c("#00822E", "#0068B4"))+
  theme_classic(base_size = 14)+
  theme(axis.text.x = element_blank(),
        axis.ticks = element_blank())+
  labs(x= "", y= "")+
  ggtitle("Geral")
```

```{r, out.width="90%"}
 casa_by +  casa +   plot_layout(widths = c(2, 1))
```

### Setor da cidade

```{r}
setor_by <- amostra_trat %>% 
  ggplot(aes(x=save,fill=factor(setor)))+
   geom_bar(position="fill", color="black")+
   scale_fill_manual("", values=c("#00822E", "#0068B4"))+
   #geom_jitter(color="black", size=0.4, alpha=0.9) +
   theme_classic(base_size = 14)+
   theme(legend.position = "none")+
   labs(x= "Tem Poupança", y= "Proporção")
   


setor <-   amostra_trat %>% 
  ggplot(aes(x=1,fill=factor(setor)))+
  geom_bar(position="fill", color="black")+
  scale_fill_manual("", values=c("#00822E", "#0068B4"))+
  theme_classic(base_size = 14)+
  theme(axis.text.x = element_blank(),
        axis.ticks = element_blank())+
  labs(x= "", y= "")+
  ggtitle("Geral")
```

```{r, out.width="90%"}
 setor_by +  setor + plot_layout(widths = c(2, 1))
```

## Análise descritiva Tabelas

```{r}
names(amostra_trat) <- c("ID", "Idade", "Status Socioeconômico", "Casa Própria", "Setor", "Poupança" )

```

```{r}

Tab1 <- papeR::summarize(amostra_trat[,-1],
                 type = "factor", group = "Poupança")
```

```{r, echo = FALSE, cache=F, results = 'asis'}

xtable(Tab1)
```

```{r}
Tab2 <- papeR::summarize(amostra_trat[,-1],
                 type = "numeric", group = "Poupança")
```

```{r, echo = FALSE, cache=F, results = 'asis'}

xtable(Tab2, width = rep("0.5in", 11))
```

Parametros e interpretacao
Modelo e residuos

## Modelagem 

```{r}
mod1 <- glm(data=amostra, save ~ idade+status+casa+setor, binomial(link = "logit"))

r <- roc( amostra$save,as.vector(fitted.values(mod1)) , percent=F,   boot.n=1000, ci.alpha=0.9, stratified=FALSE, plot=TRUE, grid=TRUE, 
          show.thres=TRUE, legacy.axes = TRUE, reuse.auc = TRUE)


p <- ggroc(r)
p <- p + ggtitle("Receiver Operating Characteristic Curve")
p <- p + ylab("Sensitivity")
p <- p + xlab("Specificity")
p <- p + geom_segment(
    aes(x = 1, xend = 0, y = 0, yend = 1), color = "grey", linetype = "dashed"
)
p <- p + scale_y_continuous(expand = c(0, 0))
p <- p + scale_x_reverse(expand = c(0, 0))
print(p)
```

fit <- glm(outcome ~ gender + age + wfns + s100b , data = aSAH, family = binomial)

 roc(aSAH$outcome, as.vector(fitted.values(fit)), percent=F,   boot.n=1000, ci.alpha=0.9, stratified=FALSE, plot=TRUE, grid=TRUE, show.thres=TRUE, legacy.axes = TRUE, reuse.auc = TRUE,
# print.thres = c(0.30,0.35, 0.40, 0.45,0.48, 0.50,0.55, 0.60),#
print.auc = TRUE, print.thres.col = "blue", ci=TRUE, ci.type="bars", print.thres.cex = 0.7, main = paste("ROC curve using","(N = ",nrow(aSAH),")") )



# Conclusão

\newpage
# Apêndice

```{r ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}
```

